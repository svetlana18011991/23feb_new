<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä ‚Äî editor+game</title>
  <script type="text/javascript" src="https://me.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=vAQSnmqvoU-az3uCUc5dGt1sVy4idcF5Sf6b_2pIWTrOZFbOdb1x03qCvkjdGE6-GYqCoRxkzSIsximsveC936ky_P3oUGlC2LwIrmK7cmRUXRTf7xBUziu9rTbRBYuMeF2_YEihzxw7WFYYru6tuC-o9RMU_cPFszq9NJj1_otMYtU4jBkwtWN2Pm4Sf9mZOK3ytdkHMLVHGgBMqFbw8ohY8mifQ0t6jf-ylsXj7kse4fsJFTEzPbhXczYZTgq6sQLte1SXq9HZ_bmHy4OJxg" charset="UTF-8"></script><style>
    :root{
      --bg0:#0b0f14;
      --card:rgba(20,28,38,.72);
      --card2:rgba(15,22,30,.62);
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:#e8eef7;
      --muted:rgba(232,238,247,.70);
      --gold: #caa24d;
      --gold2:#f1d089;
      --neon:#ff8a2a;
      --neon2:#ffb24d;
      --neonSoft: rgba(255,138,42,.18);
      --neonLine: rgba(255,138,42,.38);
      --danger:#ff5b6b;
      --ok:#33d17a;
      --shadow: 0 14px 55px rgba(0,0,0,.55);
      --r:18px;
      --qFont:'Roboto';
      --aFont:'Roboto';
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1100px 600px at 12% 12%, rgba(90,140,190,.16), transparent 60%),
                  radial-gradient(900px 520px at 70% 18%, rgba(255,190,90,.08), transparent 60%),
                  linear-gradient(180deg, #0a0f15, #080b10);
      color:var(--text);
      overflow:hidden;
    }

    /* ====== Layout (editor) ====== */
    .app{
      height:100vh;
      display:grid;
      grid-template-columns: 480px 1fr;
      gap:16px;
      padding:16px;
    }
    @media (max-width: 1100px){
      body{overflow:auto}
      .app{grid-template-columns:1fr; height:auto; min-height:100%;}
    }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--neonLine);
      border-radius: 22px;
      box-shadow: var(--shadow), 0 0 0 1px rgba(255,138,42,.20), 0 0 26px var(--neonSoft);
      overflow:hidden;
      position:relative;
      height: 100%;
      display:flex;
      flex-direction:column;
      min-height:0; /* –≤–∞–∂–Ω–æ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ –≤–Ω—É—Ç—Ä–∏ flex */
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(700px 420px at 0% 0%, rgba(255,255,255,.10), transparent 60%),
                  radial-gradient(700px 420px at 100% 0%, rgba(255,215,120,.07), transparent 65%),
                  repeating-linear-gradient(135deg, rgba(255,255,255,.03) 0 2px, transparent 2px 12px);
      opacity:.35;
      pointer-events:none;
    }
    .panel > *{position:relative; z-index:1}

    .panel:hover{
      box-shadow: var(--shadow), 0 0 0 1px rgba(255,138,42,.32), 0 0 34px rgba(255,138,42,.20);
    }
    .section:hover{
      border-color: rgba(255,138,42,.42);
      box-shadow: 0 0 0 1px rgba(255,138,42,.18), 0 0 26px rgba(255,138,42,.14);
    }
    

    .panelHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding:18px 18px 12px 18px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .title{
      font-weight:800;
      font-size:22px;
      line-height:1.15;
      letter-spacing:.2px;
    }
    .subtitle{
      margin-top:4px;
      font-size:13px;
      color:var(--muted);
    }
    .btn{
      display:inline-flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.13);
      background: rgba(25,35,46,.55);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ background: rgba(30,43,58,.68); border-color: rgba(255,255,255,.18)}
    .btn:active{ transform: translateY(1px) }
    .btnGold{
      background: linear-gradient(180deg, rgba(202,162,77,.26), rgba(202,162,77,.13));
      border-color: rgba(202,162,77,.45);
    }
    .btnDanger{
      background: linear-gradient(180deg, rgba(255,91,107,.24), rgba(255,91,107,.12));
      border-color: rgba(255,91,107,.38);
    }

    .scroll{
      flex: 1;
      min-height: 0;
      overflow:auto;
      padding: 14px 18px 18px 18px;
    }
    .section{
      background: rgba(10,14,20,.22);
      border: 1px solid rgba(255,138,42,.28);
      border-radius: 18px;
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 0 0 1px rgba(255,138,42,.12), 0 0 18px rgba(255,138,42,.10);

    }
    .section h3{
      margin:0 0 10px 0;
      font-size:14px;
      color: rgba(255,255,255,.92);
      letter-spacing:.2px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .row1{display:grid; grid-template-columns: 1fr; gap:10px;}
    
    /* === –†–ê–°–ü–û–õ–û–ñ–ï–ù–ò–ï –ë–ï–ì–£–ù–ö–û–í –í –î–í–ï –ö–û–õ–û–ù–ö–ò === */
    .orbit-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    input[type="text"], input[type="number"], select, textarea{
      width:100%;
      padding:11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      outline:none;
      background: rgba(10,14,18,.55);
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    textarea{min-height: 84px; resize: vertical;}
    /* ====== Beautify form layout ====== */
    .section .row, .section .row1{ margin-top: 10px; }
    .section .row > div,
    .section .row1 > div{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,0));
      border:1px solid rgba(255,138,42,.22);
      border-radius: 16px;
      padding: 12px 12px 10px 12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03), 0 0 14px rgba(255,138,42,.08);
      min-width: 0;
    }
    .section .row > div:hover,
    .section .row1 > div:hover{
      border-color: rgba(255,138,42,.35);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 0 18px rgba(255,138,42,.12);
    }

    /* === –°–¢–ò–õ–ò –î–õ–Ø –ö–†–ê–°–ò–í–´–• –ë–ï–ì–£–ù–ö–û–í (–†–∞–¥–∏—É—Å –∏ –°–∫–æ—Ä–æ—Å—Ç—å) === */
    .field-card {
      background: rgba(255, 255, 255, 0.03) !important;
      border: 1px solid rgba(255, 138, 42, 0.15) !important;
      border-radius: 16px !important;
      padding: 14px !important;
      margin-bottom: 0px !important; /* –£–±—Ä–∞–Ω–æ –¥–ª—è —Å–µ—Ç–∫–∏ */
    }
    .field-card label {
      display: block;
      font-weight: 800;
      font-size: 13px !important;
      color: #fff !important;
      margin-bottom: 12px !important;
      letter-spacing: 0.2px;
    }
    .field-card .hint {
      font-size: 11px;
      color: rgba(232, 238, 247, 0.5);
      margin-top: 10px;
      line-height: 1.3;
    }
    input[type="range"].range {
      -webkit-appearance: none;
      width: 100%;
      background: transparent;
      cursor: pointer;
    }
    input[type="range"].range::-webkit-slider-runnable-track {
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #ff8a2a var(--percent, 0%), rgba(255,255,255,0.1) var(--percent, 0%));
      border-radius: 3px;
    }
    input[type="range"].range::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 18px;
      width: 18px;
      border-radius: 50%;
      background: #ff8a2a;
      margin-top: -6px;
      box-shadow: 0 0 15px rgba(255, 138, 42, 0.8), 0 0 5px rgba(255, 255, 255, 0.5);
      border: 2px solid rgba(255,255,255,0.2);
      transition: transform 0.1s ease;
    }
    input[type="range"].range:active::-webkit-slider-thumb {
      transform: scale(1.2);
    }
    /* === –ö–û–ù–ï–¶ –°–¢–ò–õ–ï–ô –ë–ï–ì–£–ù–ö–û–í === */

    .section label{ margin-bottom: 7px; font-size: 12.5px; letter-spacing: .15px; }
    input[type="text"], input[type="number"], select, textarea{
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus{
      border-color: rgba(255,138,42,.55);
      box-shadow: 0 0 0 3px rgba(255,138,42,.16);
      background: rgba(10,14,18,.68);
    }
    select{
      appearance:none;
      padding-right: 38px;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(232,238,247,.75) 50%),
        linear-gradient(135deg, rgba(232,238,247,.75) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) 55%,
        calc(100% - 12px) 55%;
      background-size: 6px 6px, 6px 6px;
      background-repeat:no-repeat;
    }
    .help{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,14,18,.35);
    }
    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .qItem{
      border-color: rgba(255,138,42,.18);
    }
    .qItem:hover{
      border-color: rgba(255,138,42,.36);
      box-shadow: 0 0 0 1px rgba(255,138,42,.12), 0 0 16px rgba(255,138,42,.10);
    }

    input[type="number"]{appearance:textfield}
    .help{
      margin-top:8px;
      font-size:12px;
      color: rgba(232,238,247,.62);
      line-height:1.25;
    }
    .split{
      display:flex; align-items:center; gap:10px; justify-content:space-between;
    }
    .pill{
      font-size:12px;
      padding:5px 9px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.9);
    }
    .qList{display:flex; flex-direction:column; gap:10px;}
    .qItem{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      padding:10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,14,18,.48);
      align-items:center;
    }
    .qTitle{
      font-weight:700;
      font-size:13px;
      margin-bottom:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 320px;
    }
    .qMeta{
      font-size:12px;
      color: rgba(232,238,247,.62);
    }
    .iconBtn{
      width:38px; height:38px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(25,35,46,.45);
      color:var(--text);
      cursor:pointer;
      display:grid; place-items:center;
    }
    .iconBtn:hover{ background: rgba(25,35,46,.65) }
    .iconBtn.danger{ border-color: rgba(255,91,107,.45); background: rgba(255,91,107,.12)}
    .iconBtn.danger:hover{ background: rgba(255,91,107,.18)}
    .soundRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:end;
    }

    /* ====== Preview ====== */
    .previewWrap{
      display:flex;
      flex-direction:column;
      min-width: 0;
    }
    .previewHeader{
      padding: 14px 16px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .previewHeader .title2{
      font-weight:800;
      font-size:18px;
    }
    .previewHeader .muted{
      font-size:12px; color:var(--muted);
    }
    .previewFrame{
      flex:1;
      min-height: 420px;
      border:0;
      width:100%;
      background: transparent;
    }

    /* ====== Version badge ====== */
    .versionBadge{
      display:none !important;
      position:fixed;
      right:14px; bottom:14px;
      z-index:50;
      font-size:12px;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.9);
      pointer-events:none;
    }

    /* ====== GAME MODE ====== */
    .gameRoot{
      position:fixed;
      inset:0;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      background:#000;
    }
    .arena{
      position:relative;
      flex:1;
      border-radius: 22px;
      overflow:hidden;
      margin: 16px;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      background: #0b0f14;
    }

    /* Background image (non-transparent) */
    .arenaBg{
      position:absolute;
      inset:0;
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      transform: scale(1.06);
      filter: saturate(1.05) contrast(1.03) brightness(1.02);
    }
    .arenaBg::after{
      /* cinematic + depth */
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 20% 20%, rgba(255,230,160,.10), transparent 55%),
        radial-gradient(900px 520px at 80% 25%, rgba(100,180,255,.10), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.45));
      mix-blend-mode: multiply;
      pointer-events:none;
    }
    .arenaBg3d{
      /* subtle parallax */
      will-change: transform;
      transition: transform .08s linear;
    }

    .hud{
      position:absolute;
      top:14px; left:14px; right:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      pointer-events:none;
    }
    .hudLeft{
      pointer-events:none;
      display:flex; flex-direction:column; gap:6px;
      min-width: 260px;
      max-width: 460px;
    }
    .gameTitle{
      font-weight:900;
      font-size:22px;
      text-shadow: 0 6px 25px rgba(0,0,0,.55);
    }
    .gameHint{
      font-size:12px;
      color: rgba(255,255,255,.78);
      text-shadow: 0 6px 25px rgba(0,0,0,.55);
    }
    .hudRight{
      pointer-events:auto;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pillBtn{
      pointer-events:auto;
      border-radius: 999px;
      padding:9px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.92);
      font-weight:650;
      font-size:13px;
      cursor:pointer;
    }
    .pillBtn:hover{ background: rgba(0,0,0,.40) }
    .hudStat{
      pointer-events:none;
      border-radius: 999px;
      padding:9px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.9);
      font-weight:650;
      font-size:13px;
    }

    /* Team bars */
    .teams{
      position:absolute;
      top:78px; left:14px; right:14px;
      display:grid;
      gap:10px;
      grid-template-columns: repeat(3, minmax(0,1fr));
      pointer-events:none;
    }
    .teamCard{
      pointer-events:auto;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      padding:10px 10px 10px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-height: 56px;
    }
    .teamNameInput{
      pointer-events:auto;
      width: 100%;
      max-width: 220px;
      font-weight:800;
      font-size:14px;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      color: rgba(255,255,255,.95);
      outline:none;
    }
    .teamNameInput:focus{ border-color: rgba(202,162,77,.50); box-shadow: 0 0 0 3px rgba(202,162,77,.12); }
    .teamScore{
      font-weight:900;
      font-size:18px;
      color: rgba(255,255,255,.95);
      min-width: 40px;
      text-align:right;
    }
    .teamNow{
      display:flex; align-items:center; gap:8px;
      color: rgba(255,255,255,.78);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{
      width:10px; height:10px; border-radius: 50%;
      background: rgba(255,255,255,.24);
      border: 1px solid rgba(255,255,255,.25);
    }
    .dot.on{ background: rgba(202,162,77,.95); border-color: rgba(202,162,77,.95); box-shadow: 0 0 0 4px rgba(202,162,77,.16); }

    /* Targets */
    .targets{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .target{
      position:absolute;
      width: 92px;
      height: 92px;
      border-radius: 999px;
      pointer-events:auto;
      cursor:pointer;
      user-select:none;
      transform: translate(-50%, -50%) translate(var(--orbit-x, 0px), var(--orbit-y, 0px));
      /* fallback if image missing */
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(240,200,120,.18), transparent 65%),
        rgba(0,0,0,.20);
      box-shadow:
        0 12px 30px rgba(0,0,0,.50),
        0 0 0 2px rgba(240,200,120,.16) inset,
        0 0 22px rgba(240,200,120,.18);
      backdrop-filter: blur(2px);
    }
    .target .tImg{
      position:absolute;
      inset:-10px;
      border-radius: 999px;
      background-image: var(--target-img);
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.55));
      animation: targetFloat 2.8s ease-in-out infinite;
      animation-delay: var(--float-delay, 0s);
      transform-origin: 50% 60%;
    }
    .target .tNum{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-weight:800;
      font-size:22px;
      color:#fff;
      text-shadow: 0 2px 10px rgba(0,0,0,.75);
      letter-spacing:.5px;
    }
    .target .tPts{
      position:absolute;
      left:50%;
      bottom:-18px;
      transform: translateX(-50%);
      font-size: 11px;
      font-weight:700;
      color: rgba(240,200,120,.95);
      text-shadow: 0 2px 10px rgba(0,0,0,.75);
      white-space:nowrap;
      pointer-events:none;
    }
    .target.hit{ opacity:.25; filter: grayscale(1); }
    @keyframes targetFloat{
      0%{ transform: translateY(0px) scale(1); }
      50%{ transform: translateY(-7px) scale(1.02); }
      100%{ transform: translateY(0px) scale(1); }
    }
    .target:hover{ transform: translate(-50%,-50%) scale(1.05); }
    .target.hit{
      opacity:.38;
      filter: grayscale(1) brightness(.9);
      pointer-events:none;
    }
    .tNum{
      font-weight:900;
      font-size:18px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 10px 25px rgba(0,0,0,.65);
    }
    .tPts{
      position:absolute;
      bottom:-10px;
      left:50%;
      transform: translateX(-50%);
      padding:4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(202,162,77,.40);
      background: rgba(0,0,0,.35);
      color: rgba(255,232,190,.95);
      font-weight:800;
      font-size:11px;
      white-space:nowrap;
    }

    /* Modal (game question) */
    .modalBackdrop{
      position:absolute;
      inset:0;
      /* darker + soft orange aura */
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,138,42,.14), transparent 60%),
        radial-gradient(900px 520px at 80% 15%, rgba(255,178,77,.10), transparent 62%),
        rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 40;
    }
    .modalBackdrop.on{ display:flex; }
    .modalBackdrop.on .modal{ animation: modalPop .18s ease-out; }
    @keyframes modalPop{
      from{ transform: translateY(10px) scale(.985); opacity:.0;}
      to{ transform: translateY(0) scale(1); opacity:1;}
    }
    .modal{
      width: min(980px, 96vw);
      border-radius: 22px;
      border:1px solid var(--neonLine);
      background:
        radial-gradient(800px 420px at 22% 8%, rgba(255,138,42,.10), transparent 55%),
        linear-gradient(180deg, rgba(10,13,18,.94), rgba(6,8,10,.90));
      box-shadow:
        0 28px 110px rgba(0,0,0,.78),
        0 0 0 1px rgba(255,138,42,.18),
        0 0 46px rgba(255,138,42,.18);
      overflow:hidden;
      position:relative;
      display:flex;
      flex-direction:column;
      max-height: calc(100vh - 36px);
      backdrop-filter: blur(8px);
    }
    .modal::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 24px;
      pointer-events:none;
      background: linear-gradient(135deg, rgba(255,138,42,.35), rgba(255,178,77,.10), rgba(255,138,42,.26));
      filter: blur(14px);
      opacity:.55;
    }
    .modal::after{
      content:"";
      position:absolute; inset:0; border-radius: 22px;
      pointer-events:none;
      box-shadow: inset 0 0 0 1px rgba(255,138,42,.22), inset 0 0 34px rgba(255,138,42,.10);
    }
    .modal > *{ position:relative; }
    .modalHeader{
      padding: 14px 16px;
      background: linear-gradient(90deg, rgba(255,138,42,.18), rgba(255,138,42,.06) 40%, rgba(255,138,42,0));
      border-bottom:1px solid rgba(255,138,42,.22);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .modalHeader .h{ font-weight:900; font-size:14px; color: rgba(255,255,255,.92); }
    .modalClose{
      border-radius: 14px; padding:8px 12px; border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06); color: rgba(255,255,255,.92); cursor:pointer;
    }
    .modalClose:hover{
      border-color: rgba(255,138,42,.40); background: rgba(255,138,42,.10);
      box-shadow: 0 0 0 1px rgba(255,138,42,.18), 0 0 18px rgba(255,138,42,.20);
    }
    .modalBody{ padding: 16px; display:grid; gap:12px; overflow:auto; flex:1; min-height:0; }
    .qText{ font-weight:900; font-size:18px; line-height:1.2; font-family: var(--qFont), system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .answers{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 720px){ .answers{grid-template-columns:1fr} }
    .ansBtn{
      text-align:left; padding:14px 14px; border-radius: 18px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06); color: rgba(255,255,255,.92); cursor:pointer;
      position:relative; display:flex; gap:12px; align-items:flex-start;
      font-family: var(--aFont), system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .ansBtn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.16);}
    .ansKey{
      width: 30px; height: 30px; border-radius: 999px; border: 1px solid rgba(202,162,77,.50);
      display:grid; place-items:center; font-weight:900; color: rgba(255,232,190,.95); flex:0 0 auto;
    }
    .ansText{ font-weight:700; line-height:1.25; font-family: var(--aFont), system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .primary{ border-radius: 16px; padding: 12px 14px; border:1px solid rgba(202,162,77,.55); background: rgba(202,162,77,.18); color: rgba(255,245,225,.95); font-weight:900; cursor:pointer; }
    .secondary{ border-radius: 16px; padding: 12px 14px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color: rgba(255,255,255,.92); font-weight:800; cursor:pointer; }

    .toast{
      position:fixed; left:50%; bottom:18px; transform: translateX(-50%); padding:10px 12px;
      border-radius: 14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.92); backdrop-filter: blur(10px); display:none; z-index: 60; font-weight:700; font-size:13px;
    }
    .toast.on{ display:block; }
  
    .topBrand{position:fixed;left:18px;top:14px;z-index:9999;pointer-events:none;opacity:.98;filter:drop-shadow(0 10px 24px rgba(0,0,0,.55));display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:14px;background:linear-gradient(180deg, rgba(18,24,33,.58), rgba(10,12,16,.35));border:1px solid rgba(255,255,255,.12);backdrop-filter: blur(8px);}
    .modeGame .topBrand{ display:none; }
    .topBrand img{height:34px;width:auto;border-radius:10px;display:block;}
    .topBrand span{font-weight:800;font-size:13px;letter-spacing:.2px;color:rgba(255,255,255,.92);text-shadow:0 8px 22px rgba(0,0,0,.55);}

  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Open+Sans:wght@400;700;800&family=Lato:wght@400;700;900&family=Montserrat:wght@400;700;900&family=Poppins:wght@400;700;900&family=Inter:wght@400;700;900&family=Noto+Sans:wght@400;700;900&family=Merriweather:wght@400;700;900&family=Caveat:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>
  <div class="topBrand" aria-hidden="true">
    <img src="63.png" alt="–õ–æ–≥–æ—Ç–∏–ø" onerror="this.style.display='none'"/>
    <span>–°–≤–µ—Ç–ª–∞–Ω–∞ –ë—ã–∫–æ–≤–∞</span>
  </div>
<div id="root"></div>

<div class="toast" id="toast"></div>

<script>
const VERSION = 24;

/* ---------- helpers ---------- */
const $ = (sel, el=document)=> el.querySelector(sel);
const $$ = (sel, el=document)=> Array.from(el.querySelectorAll(sel));
const toastEl = document.getElementById('toast');
function toast(msg){
  toastEl.textContent = msg;
  toastEl.classList.add('on');
  clearTimeout(toastEl._t);
  toastEl._t = setTimeout(()=>toastEl.classList.remove('on'), 1600);
}

function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
function deepClone(x){ return JSON.parse(JSON.stringify(x)); }

/* base64url */
function b64uEncode(obj){
  const json = JSON.stringify(obj);
  const b64 = btoa(unescape(encodeURIComponent(json)));
  return b64.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}
function b64uDecode(str){
  str = str.replace(/-/g,'+').replace(/_/g,'/');
  while(str.length % 4) str += '=';
  const json = decodeURIComponent(escape(atob(str)));
  return JSON.parse(json);
}

function urlOfSelf(){
  return location.origin + location.pathname;
}

/* ---------- Default config ---------- */
function defaultCfg(){
  return {
    title: "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä",
    teamsCount: 2,
    autoNextTeam: true,
    latex: false,
    bg: "2.png",
    targetFile: "13.png",
    targetLineOffset: 0,
    targetLineJitter: 4,
    targetOrbitRadius: 0,
    targetOrbitSpeed: 0,
    shot: { variant:"pif", volume:0.7 },
    questions: [],
    qFont: 'Roboto',
    aFont: 'Roboto'
  };
}

/* ---------- LaTeX (optional) ---------- */
let katexLoaded = false;
async function ensureKatex(){
  if(katexLoaded) return;
  katexLoaded = true;
  const css = document.createElement('link');
  css.rel = 'stylesheet';
  css.href = "https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css";
  document.head.appendChild(css);

  const s1 = document.createElement('script');
  s1.src = "https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js";
  s1.defer = true;
  document.head.appendChild(s1);

  const s2 = document.createElement('script');
  s2.src = "https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js";
  s2.defer = true;
  document.head.appendChild(s2);

  await new Promise(res=> s2.onload = res);
}
function renderLatexIn(el){
  if(!window.renderMathInElement) return;
  try{
    window.renderMathInElement(el, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false},
        {left: "\\(", right: "\\)", display: false},
        {left: "\\[", right: "\\]", display: true},
      ]
    });
  }catch(e){}
}

/* ---------- Shot sound (WebAudio synth) ---------- */
const AudioKit = (() => {
  let ctx = null;
  let master = null;

  function ensure(){
    if(ctx) return;
    ctx = new (window.AudioContext || window.webkitAudioContext)();
    master = ctx.createGain();
    master.gain.value = 1.2;
    master.connect(ctx.destination);
  }
  async function unlock(){
    ensure();
    if(ctx.state === 'suspended') await ctx.resume();
  }
  function setVolume(v){
    ensure();
    master.gain.value = clamp(v, 0, 1) * 2.2;
  }
  function noiseBuffer(){
    ensure();
    const bufferSize = ctx.sampleRate * 0.15;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<data.length;i++) data[i] = (Math.random()*2 - 1) * (1 - i/data.length);
    return buffer;
  }

  function playVariant(variant){
    ensure();
    const t0 = ctx.currentTime;
    const out = ctx.createGain();
    out.gain.value = 1.25;
    out.connect(master);

    if(variant === 'pif'){
      const osc = ctx.createOscillator();
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(620, t0);
      osc.frequency.exponentialRampToValueAtTime(260, t0+0.06);
      const g = ctx.createGain();
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(0.7, t0+0.006);
      g.gain.exponentialRampToValueAtTime(0.0001, t0+0.09);
      const f = ctx.createBiquadFilter();
      f.type = 'bandpass';
      f.frequency.setValueAtTime(900, t0);
      f.Q.value = 3.5;
      osc.connect(g).connect(f).connect(out);
      osc.start(t0);
      osc.stop(t0+0.10);
    } else if(variant === 'snap'){
      const osc = ctx.createOscillator();
      osc.type = 'square';
      osc.frequency.setValueAtTime(220, t0);
      osc.frequency.exponentialRampToValueAtTime(880, t0+0.03);
      const g = ctx.createGain();
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(0.6, t0+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0+0.08);
      osc.connect(g).connect(out);
      osc.start(t0);
      osc.stop(t0+0.09);
    } else if(variant === 'boom'){
      const osc = ctx.createOscillator();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(90, t0);
      osc.frequency.exponentialRampToValueAtTime(45, t0+0.12);
      const g = ctx.createGain();
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(0.9, t0+0.015);
      g.gain.exponentialRampToValueAtTime(0.0001, t0+0.22);
      osc.connect(g).connect(out);
      osc.start(t0);
      osc.stop(t0+0.24);

      const n = ctx.createBufferSource();
      n.buffer = noiseBuffer();
      const nf = ctx.createBiquadFilter();
      nf.type = 'lowpass'; nf.frequency.setValueAtTime(800, t0);
      const ng = ctx.createGain();
      ng.gain.setValueAtTime(0.0001, t0);
      ng.gain.exponentialRampToValueAtTime(0.4, t0+0.015);
      ng.gain.exponentialRampToValueAtTime(0.0001, t0+0.18);
      n.connect(nf).connect(ng).connect(out);
      n.start(t0);
      n.stop(t0+0.19);
    }

    out.gain.setValueAtTime(1, t0);
    out.gain.exponentialRampToValueAtTime(0.0001, t0+0.35);
    setTimeout(()=>{ try{out.disconnect()}catch(e){} }, 500);
  }

  return { ensure, unlock, setVolume, playVariant };
})();

const params = new URLSearchParams(location.search);
const isGame = params.has('game');

if (isGame) {
    document.body.classList.add('modeGame');
    document.body.classList.remove('modeEditor');
}

/* ===========================
   GAME MODE
   =========================== */
function mountGame(cfg){
  const root = document.getElementById('root');
  root.innerHTML = `
    <div class="gameRoot">
      <div class="arena" id="arena">
        <div class="arenaBg arenaBg3d" id="arenaBg"></div>
        <div class="hud">
          <div class="hudLeft">
            <div class="gameTitle" id="gTitle"></div>
          </div>
          <div class="hudRight">
            <div class="hudStat" id="hudTurn">–°—Ç—Ä–µ–ª—è–µ—Ç: <b id="turnTeam">‚Äî</b></div>
            <button class="pillBtn" id="btnReset">–°–±—Ä–æ—Å</button>
          </div>
        </div>
        <div class="teams" id="teams"></div>
        <div class="targets" id="targets"></div>
        <div class="modalBackdrop" id="modalBack">
          <div class="modal">
            <div class="modalHeader">
              <div class="h" id="qHeader">–í–æ–ø—Ä–æ—Å</div>
              <button class="modalClose" id="btnClose">Esc</button>
            </div>
            <div class="modalBody">
              <div class="qText" id="qText"></div>
              <div id="answersWrap"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  const bg = document.getElementById('arenaBg');
  bg.style.backgroundImage = cfg.bg ? `url("${cfg.bg}")` : 'none';

  const teamCount = clamp(Number(cfg.teamsCount||2),1,3);
  let currentTeam = 0;
  let scores = Array(teamCount).fill(0);
  const hit = new Set();
  const questions = cfg.questions || [];

  function renderTargets(){
    const tEl = document.getElementById('targets');
    tEl.innerHTML = '';
    questions.forEach((q, i) => {
      const el = document.createElement('div');
      el.className = 'target' + (hit.has(i)?' hit':'');
      el.style.left = (15 + (i % 6) * 14) + '%';
      el.style.top = (30 + Math.floor(i / 6) * 15 + (cfg.targetLineOffset || 0)) + '%';
      el.style.setProperty('--target-img', `url("${cfg.targetFile || '13.png'}")`);
      el.innerHTML = `<div class="tImg"></div><div class="tNum">${i+1}</div>`;
      el.onclick = () => { if(!hit.has(i)) openQuestion(i); };
      tEl.appendChild(el);
    });

    if(cfg.targetOrbitRadius > 0){
      let angle = 0;
      setInterval(() => {
        angle += (cfg.targetOrbitSpeed * 0.05);
        $$('.target', tEl).forEach((t, idx) => {
          const shift = idx * 0.5;
          const dx = Math.cos(angle + shift) * cfg.targetOrbitRadius;
          const dy = Math.sin(angle + shift) * cfg.targetOrbitRadius;
          t.style.setProperty('--orbit-x', dx + 'px');
          t.style.setProperty('--orbit-y', dy + 'px');
        });
      }, 40);
    }
  }

  function openQuestion(i){
    const q = questions[i];
    document.getElementById('qText').textContent = q.text || '';
    const wrap = document.getElementById('answersWrap');
    wrap.innerHTML = '';
    if(q.type === 'choice'){
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'ansBtn';
        btn.textContent = opt.text;
        btn.onclick = () => {
          if(opt.correct) scores[currentTeam] += Number(q.points||10);
          hit.add(i);
          if(cfg.autoNextTeam) currentTeam = (currentTeam + 1) % teamCount;
          document.getElementById('modalBack').classList.remove('on');
          renderTargets();
        };
        wrap.appendChild(btn);
      });
    }
    document.getElementById('modalBack').classList.add('on');
  }

  document.getElementById('btnClose').onclick = () => document.getElementById('modalBack').classList.remove('on');
  document.getElementById('btnReset').onclick = () => location.reload();

  renderTargets();
}

/* ===========================
   EDITOR MODE
   =========================== */
function mountEditor(){
  const root = document.getElementById('root');
  root.innerHTML = `
    <div class="app">
      <div class="panel">
        <div class="panelHeader">
          <div class="title">–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–∏—Ä–∞</div>
          <button class="btn btnGold" id="copyIframe">üìã –ö–æ–¥</button>
        </div>
        <div class="scroll">
          <div class="section">
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
            <div class="row">
              <div><label>–§–æ–Ω</label><select id="bgSelect"><option value="2.png">–õ–µ—Å</option><option value="1.png">–ö–æ—Å–º–æ—Å</option></select></div>
              <div><label>–ú–∏—à–µ–Ω—å</label><select id="targetSelect"><option value="13.png">–ö–ª–∞—Å—Å–∏–∫–∞</option><option value="10.png">–¢–µ—Ö–Ω–æ</option></select></div>
            </div>
            
            <div class="orbit-row">
              <div class="field-card">
                <label>–†–∞–¥–∏—É—Å –¥–≤–∏–∂–µ–Ω–∏—è –º–∏—à–µ–Ω–∏</label>
                <input id="targetOrbitRadius" class="range" type="range" min="0" max="260" step="5" value="0" />
                <div class="hint">–†–∞–¥–∏—É—Å –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö).</div>
              </div>
              <div class="field-card">
                <label>–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –º–∏—à–µ–Ω–∏</label>
                <input id="targetOrbitSpeed" class="range" type="range" min="0" max="12" step="1" value="0" />
                <div class="hint">–°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è –º–∏—à–µ–Ω–µ–π.</div>
              </div>
            </div>
          </div>

          <div class="section">
            <button class="btn btnGold" style="width:100%" id="btnAdd">Ôºã –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            <div id="qList" style="margin-top:10px"></div>
          </div>
        </div>
      </div>
      <div class="panel previewWrap">
        <iframe class="previewFrame" id="previewFrame"></iframe>
      </div>
    </div>
  `;

  let cfg = defaultCfg();

  const syncRange = (el) => {
    if(!el) return;
    el.style.setProperty('--percent', (el.value / el.max * 100) + '%');
  };

  const updatePreview = () => {
    cfg.bg = document.getElementById('bgSelect').value;
    cfg.targetFile = document.getElementById('targetSelect').value;
    cfg.targetOrbitRadius = Number(document.getElementById('targetOrbitRadius').value);
    cfg.targetOrbitSpeed = Number(document.getElementById('targetOrbitSpeed').value);
    document.getElementById('previewFrame').src = urlOfSelf() + `?game=${b64uEncode(cfg)}&v=${VERSION}`;
  };

  ['targetOrbitRadius', 'targetOrbitSpeed'].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener('input', (e) => { syncRange(e.target); updatePreview(); });
    syncRange(el);
  });

  document.getElementById('bgSelect').onchange = updatePreview;
  document.getElementById('targetSelect').onchange = updatePreview;
  document.getElementById('btnAdd').onclick = () => {
    cfg.questions.push({text: "–í–æ–ø—Ä–æ—Å", type: "choice", options: [{text: "–î–∞", correct: true}]});
    updatePreview();
  };

  updatePreview();
}

(function boot(){
  if(isGame){
    let cfg = defaultCfg();
    try { cfg = Object.assign(cfg, b64uDecode(params.get('game'))); } catch(e){}
    mountGame(cfg);
  } else {
    mountEditor();
  }
})();
</script>
</body>
</html>
