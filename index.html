<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä ‚Äî Editor v26</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&family=Neucha&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ '–ë–∞—à–Ω—è' */
    :root {
      --text:#eaf0ff; --muted:#a9b6e6; --border: rgba(255,255,255,.10);
      --neon-orange-base: #ffae00; --neon-orange-glow: rgba(255, 136, 0, 0.6);
      --neon-box-shadow: 0 0 5px var(--neon-orange-glow), 0 0 15px var(--neon-orange-glow);
    }
    * { box-sizing:border-box; font-family: 'Roboto', sans-serif; }
    body { margin:0; color:var(--text); background: #0a0f15; min-height:100vh; overflow:hidden; }
    
    .app { display:grid; grid-template-columns: 460px 1fr; gap:14px; padding:14px; max-width: 1600px; margin: 0 auto; height: 100vh; }
    .panel { background:rgba(255,255,255,.07); border:1px solid var(--neon-orange-base); border-radius:22px; box-shadow: var(--neon-box-shadow); display:flex; flex-direction:column; overflow:hidden; position:relative; }
    .scroll { flex:1; overflow-y:auto; padding:14px; }
    .section { background: rgba(20, 10, 0, 0.3); border: 1px solid rgba(255, 174, 0, 0.5); border-radius:16px; padding:12px; margin-bottom:12px; }
    .title { font-weight:900; font-size:14px; color:var(--neon-orange-base); margin-bottom:10px; display:flex; justify-content:space-between; }
    
    input, select, textarea { width:100%; border-radius:12px; padding:10px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.3); color:#fff; outline:none; }
    input:focus { border-color: var(--neon-orange-base); box-shadow: 0 0 8px var(--neon-orange-glow); }
    
    .btn { padding:10px 14px; border-radius:12px; border:1px solid var(--neon-orange-base); background:rgba(255,255,255,.06); color:#fff; cursor:pointer; font-weight:900; transition: 0.2s; display:inline-flex; align-items:center; gap:8px; }
    .btn:hover { box-shadow: 0 0 10px var(--neon-orange-glow); background:rgba(255, 136, 0, 0.15); }
    .btn.primary { background: linear-gradient(90deg, rgba(255, 174, 0, 0.4), rgba(255, 136, 0, 0.3)); }
    
    .topBrand { display:flex; align-items:center; gap:12px; padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.1); }
    .topBrand img { height:40px; border-radius:8px; }

    .preview-stage { position:relative; flex:1; background:rgba(0,0,0,0.2); border-radius:20px; overflow:hidden; border:1px solid rgba(255,255,255,0.1); }
    iframe { width:100%; height:100%; border:0; }

    .target { position:absolute; width: 80px; height: 80px; transform: translate(-50%, -50%); cursor: move; z-index: 100; border: 2px dashed var(--neon-orange-base); border-radius: 50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:900; }
    
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal { width:min(800px, 95%); background:#16110c; border:1px solid var(--neon-orange-base); border-radius:20px; padding:20px; box-shadow: var(--neon-box-shadow); max-height: 90vh; overflow-y: auto; }
  </style>
</head>
<body>

<div class="app">
  <div class="panel scroll">
    <div class="topBrand">
      <img src="63.png" onerror="this.style.display='none'"/>
      <div>
        <div style="font-weight:900; font-size:16px;">–°–≤–µ—Ç–ª–∞–Ω–∞ –ë—ã–∫–æ–≤–∞</div>
        <div style="color:var(--neon-orange-base); font-size:12px;" data-i18n="editorTitle">–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä¬ª</div>
      </div>
    </div>

    <div class="section" style="margin-top:15px;">
      <div class="title" data-i18n="langTitle">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
      <select id="selLang">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">English</option>
      </select>
    </div>

    <div class="section">
      <div class="title" data-i18n="secTitleName">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
      <input type="text" id="inpTitle" value="–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä">
    </div>

    <div class="section">
      <div class="title" data-i18n="secTitleDesign">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</div>
      <label data-i18n="lblCustomBg">–§–æ–Ω –∏–≥—Ä—ã (—Å—Å—ã–ª–∫–∞)</label>
      <input type="text" id="inpBg" value="2.png">
      <label style="margin-top:10px; display:block">–ú–∏—à–µ–Ω—å (URL)</label>
      <input type="text" id="inpTargetImg" value="13.png">
      
      <div style="margin-top:15px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <div>
          <label>–†–∞–¥–∏—É—Å –¥–≤–∏–∂–µ–Ω–∏—è</label>
          <input type="range" id="inpRadius" min="0" max="200" value="0">
        </div>
        <div>
          <label>–°–∫–æ—Ä–æ—Å—Ç—å</label>
          <input type="range" id="inpSpeed" min="0" max="10" value="0">
        </div>
      </div>
    </div>

    <div class="section">
      <div class="title" data-i18n="secTitleInstruction">–°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω</div>
      <textarea id="inpInstText" placeholder="–¢–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"></textarea>
      <div style="display:flex; gap:10px; margin-top:10px;">
        <input type="color" id="inpInstColor" value="#ff8a2a" style="width:50px; height:40px;">
        <div style="display:flex; align-items:center; gap:5px;">
          <input type="checkbox" id="chkInstGlow" checked> <span data-i18n="lblInstructionGlow">–°–≤–µ—á–µ–Ω–∏–µ</span>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="title"><span data-i18n="secTitleQuestions">–í–æ–ø—Ä–æ—Å—ã</span> <span id="qCount">0 / 9</span></div>
      <div style="display:flex; gap:10px;">
        <button class="btn primary" id="btnAddQ" data-i18n="btnAdd">Ôºã –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="btn" id="btnClear" data-i18n="btnClear">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      <div id="qList" style="margin-top:12px;"></div>
    </div>
    
    <button class="btn primary" id="btnCopy" style="width:100%;" data-i18n="btnCopyCode">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (iframe)</button>
  </div>

  <div class="panel previewWrap">
    <div style="padding:12px; border-bottom:1px solid rgba(255,255,255,0.1); font-weight:900;" data-i18n="previewTitle">–ü—Ä–æ—Å–º–æ—Ç—Ä</div>
    <div class="preview-stage">
      <iframe id="livePreview"></iframe>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="title"><span id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</span> <button class="btn" onclick="closeModal()">‚úñ</button></div>
    <label data-i18n="lblQType">–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</label>
    <select id="selType">
      <option value="choice">–° –≤—ã–±–æ—Ä–æ–º –æ—Ç–≤–µ—Ç–∞</option>
      <option value="text">–° –≤–≤–æ–¥–æ–º –æ—Ç–≤–µ—Ç–∞</option>
    </select>
    
    <label data-i18n="lblQuestionText">–í–æ–ø—Ä–æ—Å</label>
    <textarea id="inpPrompt"></textarea>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
      <div>
        <label data-i18n="lblFont">–®—Ä–∏—Ñ—Ç</label>
        <select id="inpFont">
          <option value="Roboto">Roboto</option>
          <option value="Caveat">Caveat</option>
          <option value="Neucha">Neucha</option>
        </select>
      </div>
      <div>
        <label data-i18n="lblFontSize">–†–∞–∑–º–µ—Ä (px)</label>
        <input type="number" id="inpFontSize" value="20">
      </div>
    </div>

    <div id="choiceArea" style="margin-top:15px;">
      <div style="font-weight:900;">–í–∞—Ä–∏–∞–Ω—Ç—ã (–æ—Ç–º–µ—Ç—å—Ç–µ –≤–µ—Ä–Ω—ã–π):</div>
      <div id="optList"></div>
      <button class="btn" onclick="addOption()" style="margin-top:10px;">Ôºã –í–∞—Ä–∏–∞–Ω—Ç</button>
    </div>

    <div style="margin-top:20px; display:flex; justify-content:flex-end; gap:10px;">
      <button class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn primary" id="btnSaveQ">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
let cfg = {
  title: "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä",
  bg: "2.png",
  targetImg: "13.png",
  radius: 0, speed: 0,
  inst: { text: "–°–±–µ–π –º–∏—à–µ–Ω—å –∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å!", color: "#ff8a2a", glow: true },
  questions: []
};

let editIdx = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function init() {
  document.getElementById('inpTitle').oninput = e => { cfg.title = e.target.value; update(); };
  document.getElementById('inpBg').onchange = e => { cfg.bg = e.target.value; update(); };
  document.getElementById('inpTargetImg').onchange = e => { cfg.targetImg = e.target.value; update(); };
  document.getElementById('inpRadius').oninput = e => { cfg.radius = e.target.value; update(); };
  document.getElementById('inpSpeed').oninput = e => { cfg.speed = e.target.value; update(); };
  
  document.getElementById('btnAddQ').onclick = () => openModal();
  document.getElementById('btnClear').onclick = () => { cfg.questions = []; renderQ(); update(); };
  document.getElementById('btnSaveQ').onclick = saveQ;
  
  update();
}

function update() {
  const data = btoa(unescape(encodeURIComponent(JSON.stringify(cfg))));
  document.getElementById('livePreview').src = location.origin + location.pathname + "?game=" + data + "&edit=1";
  document.getElementById('qCount').innerText = cfg.questions.length + " / 9";
}

function openModal(idx = null) {
  editIdx = idx;
  const q = idx !== null ? cfg.questions[idx] : { prompt: "", type: "choice", options: ["–î–∞", "–ù–µ—Ç"], correct: 0, font: "Roboto", size: 20 };
  
  document.getElementById('inpPrompt').value = q.prompt;
  document.getElementById('selType').value = q.type;
  document.getElementById('modalBackdrop').style.display = 'flex';
  renderOptions(q.options, q.correct);
}

function renderOptions(opts, correct) {
  const list = document.getElementById('optList');
  list.innerHTML = opts.map((o, i) => `
    <div style="display:flex; gap:10px; margin-top:5px;">
      <input type="radio" name="correct" ${i===correct?'checked':''} value="${i}">
      <input type="text" value="${o}" oninput="updateOpt(${i}, this.value)">
    </div>
  `).join('');
}

function saveQ() {
  const q = {
    prompt: document.getElementById('inpPrompt').value,
    type: document.getElementById('selType').value,
    options: ["–î–∞", "–ù–µ—Ç"], // –£–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    correct: 0,
    x: editIdx !== null ? cfg.questions[editIdx].x : 50,
    y: editIdx !== null ? cfg.questions[editIdx].y : 50
  };
  
  if(editIdx !== null) cfg.questions[editIdx] = q;
  else cfg.questions.push(q);
  
  closeModal();
  renderQ();
  update();
}

function renderQ() {
  const list = document.getElementById('qList');
  list.innerHTML = cfg.questions.map((q, i) => `
    <div class="section" style="display:flex; justify-content:space-between; align-items:center;">
      <span>#${i+1} ${q.prompt.slice(0,15)}...</span>
      <div><button class="btn" onclick="openModal(${i})">‚úèÔ∏è</button></div>
    </div>
  `).join('');
}

function closeModal() { document.getElementById('modalBackdrop').style.display = 'none'; }

// –õ–æ–≥–∏–∫–∞ Drag-and-Drop –∏–∑ Iframe
window.addEventListener('message', e => {
  if(e.data.type === 'updCoords') {
    cfg.questions[e.data.idx].x = e.data.x;
    cfg.questions[e.data.idx].y = e.data.y;
    renderQ();
  }
});

// –ó–∞–ø—É—Å–∫ (–µ—Å–ª–∏ –Ω–µ –∏–≥—Ä–∞)
if(!window.location.search.includes('game')) init();

</script>
</body>
</html>
