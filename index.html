<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä ‚Äî editor+game</title>
  <style>
    :root{
      --bg0:#0b0f14;
      --card:rgba(20,28,38,.72);
      --card2:rgba(15,22,30,.62);
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:#e8eef7;
      --muted:rgba(232,238,247,.70);
      --gold: #caa24d;
      --gold2:#f1d089;
      --neon:#ff8a2a;
      --neon2:#ffb24d;
      --neonSoft: rgba(255,138,42,.18);
      --neonLine: rgba(255,138,42,.38);
      --danger:#ff5b6b;
      --ok:#33d17a;
      --shadow: 0 14px 55px rgba(0,0,0,.55);
      --r:18px;
      --qFont:'Roboto';
      --aFont:'Roboto';
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1100px 600px at 12% 12%, rgba(90,140,190,.16), transparent 60%),
                  radial-gradient(900px 520px at 70% 18%, rgba(255,190,90,.08), transparent 60%),
                  linear-gradient(180deg, #0a0f15, #080b10);
      color:var(--text);
      overflow:hidden;
    }

    /* ====== Layout (editor) ====== */
    .app{
      height:100vh;
      display:grid;
      grid-template-columns: 480px 1fr;
      gap:16px;
      padding:16px;
    }
    @media (max-width: 1100px){
      body{overflow:auto}
      .app{grid-template-columns:1fr; height:auto; min-height:100%;}
    }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--neonLine);
      border-radius: 22px;
      box-shadow: var(--shadow), 0 0 0 1px rgba(255,138,42,.20), 0 0 26px var(--neonSoft);
      overflow:hidden;
      position:relative;
      height: 100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .panelHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding:18px 18px 12px 18px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .title{ font-weight:800; font-size:22px; line-height:1.15; letter-spacing:.2px; }
    .btn{
      display:inline-flex; gap:10px; align-items:center; justify-content:center;
      padding:10px 14px; border-radius: 14px; border:1px solid rgba(255,255,255,.13);
      background: rgba(25,35,46,.55); color:var(--text); cursor:pointer; user-select:none;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btnGold{ background: linear-gradient(180deg, rgba(202,162,77,.26), rgba(202,162,77,.13)); border-color: rgba(202,162,77,.45); }
    .scroll{ flex: 1; overflow:auto; padding: 14px 18px 18px 18px; }
    .section{
      background: rgba(10,14,20,.22); border: 1px solid rgba(255,138,42,.28);
      border-radius: 18px; padding: 14px; margin-bottom: 14px;
    }
    .section h3{ margin:0 0 10px 0; font-size:14px; color: rgba(255,255,255,.92); }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top: 10px; }
    .row1{ display:grid; grid-template-columns: 1fr; gap:10px; margin-top: 10px; }

    /* ====== –ü–æ–ª—è –≤–≤–æ–¥–∞ ====== */
    input[type="text"], textarea, select {
      width:100%; padding:11px 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.12);
      outline:none; background: rgba(10,14,18,.55); color: var(--text);
    }

    /* ====== –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –±–µ–≥—É–Ω–∫–æ–≤ ====== */
    .field-card {
      background: rgba(255, 255, 255, 0.03) !important;
      border: 1px solid rgba(255, 138, 42, 0.15) !important;
      border-radius: 16px !important;
      padding: 14px !important;
    }
    .field-card label { display: block; font-weight: 800; font-size: 13px; color: #fff; margin-bottom: 8px; }
    input[type="range"].range { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
    input[type="range"].range::-webkit-slider-runnable-track { height: 6px; background: linear-gradient(90deg, #ff8a2a var(--percent, 0%), rgba(255,255,255,0.1) var(--percent, 0%)); border-radius: 3px; }
    input[type="range"].range::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #ff8a2a; margin-top: -6px; box-shadow: 0 0 15px rgba(255, 138, 42, 0.8); border: 2px solid rgba(255,255,255,0.2); }

    /* ====== –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –∏–≥—Ä—ã ====== */
    .overlay-screen {
      position: absolute; inset: 0; z-index: 500; background: rgba(0,0,0,0.85);
      display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px);
    }
    .modal-start-end {
      width: min(550px, 90%); padding: 35px; border-radius: 28px; text-align: center;
      background: #0b0f14; border-width: 4px; border-style: solid; color: #fff;
    }
    .results-table { margin: 25px 0; width: 100%; border-collapse: collapse; }
    .results-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 18px; }
    .results-table .team-name { text-align: left; font-weight: 700; }
    .results-table .team-score { text-align: right; color: var(--neon); font-weight: 900; }

    /* Preview & Game */
    .previewFrame{ flex:1; border:0; width:100%; background: transparent; }
    .gameRoot{ position:fixed; inset:0; display:flex; flex-direction:column; background:#000; }
    .arena{ position:relative; flex:1; border-radius: 22px; overflow:hidden; margin: 16px; border: 1px solid rgba(255,255,255,.10); background: #0b0f14; }
    .arenaBg{ position:absolute; inset:0; background-size: cover; background-position: center; transform: scale(1.06); }
    .targets{ position:absolute; inset:0; }
    .target{ position:absolute; width: 92px; height: 92px; border-radius: 999px; transform: translate(-50%, -50%); cursor:pointer; }
    .target .tImg{ position:absolute; inset:-10px; background-image: var(--target-img); background-size: contain; background-repeat: no-repeat; }
    .target .tNum{ position:absolute; inset:0; display:grid; place-items:center; font-weight:900; font-size:22px; color:#fff; text-shadow: 0 2px 10px #000; }
    .target.hit { opacity: 0; pointer-events: none; }
    .hud{ position:absolute; top:14px; left:14px; right:14px; display:flex; justify-content:space-between; pointer-events:none; z-index: 10;}
    .hudStat, .pillBtn{ pointer-events:auto; border-radius: 999px; padding: 9px 12px; border:1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.3); color: #fff; font-size:13px; }
  </style>
</head>
<body>

<div id="root"></div>

<script>
const VERSION = 28;
const $ = (sel, el=document)=> el.querySelector(sel);
const $$ = (sel, el=document)=> Array.from(el.querySelectorAll(sel));

function b64uEncode(obj){ return btoa(unescape(encodeURIComponent(JSON.stringify(obj)))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,''); }
function b64uDecode(str){ return JSON.parse(decodeURIComponent(escape(atob(str.replace(/-/g,'+').replace(/_/g,'/'))))); }

function defaultCfg(){
  return {
    title: "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏—Ä", bg: "2.png", targetFile: "13.png", teamsCount: 2,
    targetOrbitRadius: 0, targetOrbitSpeed: 0, questions: [],
    startText: "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ù–∞–≤–æ–¥–∏—Ç–µ –ø—Ä–∏—Ü–µ–ª –Ω–∞ –º–∏—à–µ–Ω–∏, —Å—Ç—Ä–µ–ª—è–π—Ç–µ –∏ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –±–∞–ª–ª—ã –¥–ª—è —Å–≤–æ–µ–π –∫–æ–º–∞–Ω–¥—ã!",
    startColor: "#ff8a2a", startGlow: true,
    feedbackText: "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –∏–≥—Ä—ã! –í—ã –ø–æ–∫–∞–∑–∞–ª–∏ –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã."
  };
}

const params = new URLSearchParams(location.search);
const isGame = params.has('game');

/* =========================== GAME MODE =========================== */
function mountGame(cfg){
  document.getElementById('root').innerHTML = `
    <div class="gameRoot">
      <div class="arena" id="arena">
        <div class="arenaBg" id="arenaBg" style="background-image:url('${cfg.bg}')"></div>
        
        <div id="startScreen" class="overlay-screen">
          <div class="modal-start-end" style="border-color:${cfg.startColor}; box-shadow:${cfg.startGlow ? '0 0 40px '+cfg.startColor : 'none'}">
            <h1 style="color:${cfg.startColor}; margin-top:0">–ò–ù–°–¢–†–£–ö–¶–ò–Ø</h1>
            <p style="font-size:20px; line-height:1.5; margin: 25px 0;">${cfg.startText}</p>
            <button class="btn btnGold" style="font-size:18px; padding:15px 30px" onclick="document.getElementById('startScreen').remove()">–ü–û–ù–Ø–¢–ù–û</button>
          </div>
        </div>

        <div id="endScreen" class="overlay-screen" style="display:none">
          <div class="modal-start-end" style="border-color:${cfg.startColor}">
            <h1 style="color:${cfg.startColor}; margin-top:0">–ò–¢–û–ì–ò –ò–ì–†–´</h1>
            <table class="results-table" id="resultsTable"></table>
            <p style="font-size:18px; margin-top:20px; color: #ccc;">${cfg.feedbackText}</p>
            <button class="btn btnGold" style="margin-top:20px" onclick="location.reload()">–ò–ì–†–ê–¢–¨ –ï–©–ï –†–ê–ó</button>
          </div>
        </div>

        <div class="hud">
          <div class="hudStat">–•–æ–¥: <b id="turnTeam">-</b></div>
          <div class="hudStat">–°—á—ë—Ç: <b id="hitCount">0</b></div>
        </div>
        <div id="targets" class="targets"></div>
      </div>
    </div>
  `;

  let hits = 0;
  let currentTeamIdx = 0;
  let teams = Array.from({length: cfg.teamsCount}, (_, i) => ({ name: `–ö–æ–º–∞–Ω–¥–∞ ${i+1}`, score: 0 }));

  const updateHud = () => {
    $('#turnTeam').textContent = teams[currentTeamIdx].name;
    $('#hitCount').textContent = hits + " / " + cfg.questions.length;
  };
  updateHud();

  const tContainer = $('#targets');
  cfg.questions.forEach((q, i) => {
    const el = document.createElement('div');
    el.className = 'target';
    el.style.left = (15 + (i%5)*15) + '%';
    el.style.top = (30 + Math.floor(i/5)*15) + '%';
    el.style.setProperty('--target-img', `url("${cfg.targetFile}")`);
    el.innerHTML = `<div class="tImg"></div><div class="tNum">${i+1}</div>`;
    
    el.onclick = () => {
      el.classList.add('hit');
      teams[currentTeamIdx].score += 10;
      hits++;
      currentTeamIdx = (currentTeamIdx + 1) % teams.length;
      updateHud();
      if(hits >= cfg.questions.length) {
        const table = $('#resultsTable');
        table.innerHTML = teams.map(t => `<tr><td class="team-name">${t.name}</td><td class="team-score">${t.score} –ë–ê–õ–õ–û–í</td></tr>`).join('');
        $('#endScreen').style.display = 'flex';
      }
    };
    tContainer.appendChild(el);
  });
}

/* =========================== EDITOR MODE =========================== */
function mountEditor() {
  document.getElementById('root').innerHTML = `
    <div class="app">
      <div class="panel">
        <div class="panelHeader">
          <div class="title">–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–∏—Ä–∞</div>
          <button class="btn btnGold" id="copyCode">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
        </div>
        <div class="scroll">
          
          <div class="section">
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã</h3>
            <div class="row">
              <div><label>–§–æ–Ω</label><select id="bgSelect"><option value="2.png">–õ–µ—Å</option><option value="1.png">–ö–æ—Å–º–æ—Å</option></select></div>
              <div><label>–ú–∏—à–µ–Ω—å</label><select id="targetSelect"><option value="13.png">–ö–ª–∞—Å—Å–∏–∫–∞</option><option value="10.png">–¢–µ—Ö–Ω–æ</option></select></div>
            </div>
          </div>

          <div class="section">
            <h3>–°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω</h3>
            <div class="row">
              <div class="field-card">
                <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
                <input type="color" id="startColor" value="#ff8a2a" style="width:100%; height:30px; border:0; cursor:pointer">
              </div>
              <div class="field-card" style="display:flex; align-items:center; gap:10px">
                <input type="checkbox" id="startGlow" checked> <label style="margin:0">–°–≤–µ—á–µ–Ω–∏–µ</label>
              </div>
            </div>
            <div class="row1">
              <div class="field-card">
                <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</label>
                <textarea id="startText" rows="3"></textarea>
              </div>
            </div>
          </div>

          <div class="section">
            <h3>–§–∏–¥–±–µ–∫</h3>
            <div class="row1">
              <div class="field-card">
                <label>–¢–µ–∫—Å—Ç –≤ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã</label>
                <textarea id="feedbackText" rows="2"></textarea>
              </div>
            </div>
          </div>

          <div class="section">
            <h3>–î–≤–∏–∂–µ–Ω–∏–µ –º–∏—à–µ–Ω–µ–π</h3>
            <div class="row">
              <div class="field-card">
                <label>–†–∞–¥–∏—É—Å</label>
                <input id="targetOrbitRadius" class="range" type="range" min="0" max="260" step="5" value="0">
              </div>
              <div class="field-card">
                <label>–°–∫–æ—Ä–æ—Å—Ç—å</label>
                <input id="targetOrbitSpeed" class="range" type="range" min="0" max="12" step="1" value="0">
              </div>
            </div>
          </div>

          <div class="section">
            <button class="btn btnGold" style="width:100%" id="addQ">Ôºã –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            <div id="qList" style="margin-top:10px"></div>
          </div>
        </div>
      </div>
      <div class="panel"><iframe id="preview" class="previewFrame"></iframe></div>
    </div>
  `;

  let cfg = defaultCfg();
  $('#startText').value = cfg.startText;
  $('#feedbackText').value = cfg.feedbackText;

  function syncR(el) { el.style.setProperty('--percent', (el.value / el.max * 100) + '%'); }

  function updatePreview(){
    cfg.bg = $('#bgSelect').value;
    cfg.targetFile = $('#targetSelect').value;
    cfg.startText = $('#startText').value;
    cfg.feedbackText = $('#feedbackText').value;
    cfg.startColor = $('#startColor').value;
    cfg.startGlow = $('#startGlow').checked;
    cfg.targetOrbitRadius = $('#targetOrbitRadius').value;
    cfg.targetOrbitSpeed = $('#targetOrbitSpeed').value;
    
    syncR($('#targetOrbitRadius'));
    syncR($('#targetOrbitSpeed'));

    $('#preview').src = location.origin + location.pathname + '?game=' + b64uEncode(cfg);
  }

  $$('input, textarea, select').forEach(el => el.oninput = updatePreview);
  
  $('#addQ').onclick = () => { 
    cfg.questions.push({text:"?"}); 
    const item = document.createElement('div');
    item.className = 'field-card';
    item.style.marginTop = '5px';
    item.textContent = "–í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω";
    $('#qList').appendChild(item);
    updatePreview(); 
  };

  $('#copyCode').onclick = () => {
    const code = `<iframe src="${$('#preview').src}" style="width:100%;height:600px;border:0;" allowfullscreen></iframe>`;
    navigator.clipboard.writeText(code);
    alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
  };

  updatePreview();
}

if(isGame) mountGame(b64uDecode(params.get('game')));
else mountEditor();
</script>
</body>
</html>
